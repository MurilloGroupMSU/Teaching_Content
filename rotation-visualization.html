<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Rotation and Covariance</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .controls {
            margin: 20px 0;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .visualization {
            display: flex;
            gap: 40px;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
        }
        .matrix {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 4px;
            padding: 16px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        .matrix-cell {
            width: 100px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: monospace;
            font-size: 16px;
            background: white;
            border-radius: 4px;
        }
        .button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            background: #0070f3;
            color: white;
            cursor: pointer;
            font-size: 14px;
        }
        .button:hover {
            background: #0051a2;
        }
        .button.outline {
            background: white;
            color: #0070f3;
            border: 1px solid #0070f3;
        }
        .slider {
            width: 300px;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const App = () => {
            const [angle, setAngle] = React.useState(0);
            const [isPlaying, setIsPlaying] = React.useState(false);
            const [data] = React.useState(() => {
                const n = 100;
                const correlation = 0.8;
                const x = Array.from({length: n}, () => Math.random() * 2 - 1);
                const y = x.map(val => 
                    val * correlation + (Math.random() * 0.5 - 0.25));
                return [x, y];
            });

            React.useEffect(() => {
                if (!isPlaying) return;
                const timer = setInterval(() => {
                    setAngle(prev => (prev + 2) % 360);
                }, 50);
                return () => clearInterval(timer);
            }, [isPlaying]);

            const rotatePoint = (x, y, degrees) => {
                const radians = degrees * Math.PI / 180;
                const cos = Math.cos(radians);
                const sin = Math.sin(radians);
                return [
                    x * cos - y * sin,
                    x * sin + y * cos
                ];
            };

            const calculateCovariance = (x, y) => {
                const meanX = x.reduce((a, b) => a + b, 0) / x.length;
                const meanY = y.reduce((a, b) => a + b, 0) / y.length;
                const centeredX = x.map(val => val - meanX);
                const centeredY = y.map(val => val - meanY);
                const covXX = centeredX.reduce((acc, val, i) => 
                    acc + val * centeredX[i], 0) / (x.length - 1);
                const covYY = centeredY.reduce((acc, val, i) => 
                    acc + val * centeredY[i], 0) / (y.length - 1);
                const covXY = centeredX.reduce((acc, val, i) => 
                    acc + val * centeredY[i], 0) / (x.length - 1);
                return [[covXX, covXY], [covXY, covYY]];
            };

            const [x, y] = data;
            const rotatedPoints = x.map((val, i) => 
                rotatePoint(val, y[i], angle));
            const rotatedX = rotatedPoints.map(p => p[0]);
            const rotatedY = rotatedPoints.map(p => p[1]);
            const covMatrix = calculateCovariance(rotatedX, rotatedY);
            const scale = 100;

            return (
                <div className="container">
                    <h1>Data Rotation and Covariance Matrix</h1>
                    
                    <div className="controls">
                        <button 
                            className="button"
                            onClick={() => setIsPlaying(!isPlaying)}
                        >
                            {isPlaying ? 'Pause' : 'Play'}
                        </button>
                        <button 
                            className="button outline"
                            onClick={() => setAngle(0)}
                        >
                            Reset
                        </button>
                        <input 
                            type="range"
                            className="slider"
                            min="0"
                            max="360"
                            value={angle}
                            onChange={(e) => {
                                setIsPlaying(false);
                                setAngle(Number(e.target.value));
                            }}
                        />
                        <span>{angle.toFixed(1)}Â°</span>
                    </div>

                    <div className="visualization">
                        <svg 
                            width="300"
                            height="300"
                            viewBox="-120 -120 240 240"
                            style={{border: '1px solid #eee', borderRadius: '4px'}}
                        >
                            <line 
                                x1="-100" y1="0" x2="100" y2="0" 
                                stroke="gray" strokeWidth="1" 
                            />
                            <line 
                                x1="0" y1="-100" x2="0" y2="100" 
                                stroke="gray" strokeWidth="1" 
                            />
                            {rotatedPoints.map(([x, y], i) => (
                                <circle
                                    key={i}
                                    cx={x * scale}
                                    cy={y * scale}
                                    r="3"
                                    fill="#0070f3"
                                    opacity="0.5"
                                />
                            ))}
                        </svg>

                        <div className="matrix">
                            {covMatrix.flat().map((value, i) => (
                                <div
                                    key={i}
                                    className="matrix-cell"
                                    style={{
                                        backgroundColor: `rgba(0, 112, 243, ${Math.abs(value) * 0.5})`
                                    }}
                                >
                                    {value.toFixed(3)}
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
