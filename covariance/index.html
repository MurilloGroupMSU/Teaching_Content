<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Rotation and Covariance | MSU</title>
    <style>
        :root {
            --msu-green: #18453B;
            --msu-light: #2D6154;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .title {
            color: var(--msu-green);
            margin-bottom: 20px;
        }

        .controls {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            align-items: center;
            flex-wrap: wrap;
        }

        .visualization {
            display: flex;
            gap: 40px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }

        .button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            background: var(--msu-green);
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        .button:hover {
            background: var(--msu-light);
        }

        .button.outline {
            background: white;
            color: var(--msu-green);
            border: 1px solid var(--msu-green);
        }

        .button.outline:hover {
            background: #f0f0f0;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .slider {
            width: 200px;
        }

        .matrix-cell {
            width: 100px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: monospace;
            font-size: 16px;
            background: white;
            color: var(--msu-green);
        }

        .stats {
            margin-top: 20px;
            text-align: center;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">Data Rotation and Covariance Matrix</h1>

        <div class="controls">
            <div class="slider-container">
                <button class="button outline" id="playPause">Play</button>
                <input type="range" class="slider" id="rotationSlider" min="0" max="360" value="0">
                <span id="angleDisplay">0째</span>
            </div>
            <button class="button outline" id="reset">Reset</button>
            <button class="button" id="generateNew">Generate New Data</button>
        </div>

        <div class="visualization">
            <!-- Data plot -->
            <div style="position: relative;">
                <svg id="plot" width="400" height="400" viewBox="-120 -120 240 240">
                    <!-- Grid pattern -->
                    <defs>
                        <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
                            <path d="M 20 0 L 0 0 0 20" fill="none" stroke="#eee" stroke-width="0.5"/>
                        </pattern>
                    </defs>
                    <rect x="-100" y="-100" width="200" height="200" fill="url(#grid)"/>
                    
                    <!-- Axes -->
                    <line x1="-100" y1="0" x2="100" y2="0" stroke="#666" stroke-width="1"/>
                    <line x1="0" y1="-100" x2="0" y2="100" stroke="#666" stroke-width="1"/>
                    
                    <!-- Axis labels -->
                    <text x="90" y="20" text-anchor="middle" fill="#666">X</text>
                    <text x="-20" y="-90" text-anchor="middle" fill="#666">Y</text>
                </svg>
            </div>

            <!-- Covariance matrix -->
            <div id="covarianceMatrix" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 4px; padding: 16px; background: #f8f9fa; border-radius: 4px;"></div>
        </div>

        <div class="stats">
            <p>Correlation: <span id="correlationValue">0.00</span></p>
        </div>
    </div>

    <script>
        // Initialize variables
        let isPlaying = false;
        let angle = 0;
        let animationId;
        let data = [];

        // Generate initial data
        function generateData() {
            const n = 100;
            const correlation = 0.8;
            const x = Array.from({length: n}, () => Math.random() * 2 - 1);
            const y = x.map(val => val * correlation + (Math.random() * 0.5 - 0.25));
            return [x, y];
        }

        // Rotate point
        function rotatePoint(x, y, degrees) {
            const radians = degrees * Math.PI / 180;
            const cos = Math.cos(radians);
            const sin = Math.sin(radians);
            return [
                x * cos - y * sin,
                x * sin + y * cos
            ];
        }

        // Calculate covariance matrix
        function calculateCovariance(x, y) {
            const meanX = x.reduce((a, b) => a + b, 0) / x.length;
            const meanY = y.reduce((a, b) => a + b, 0) / y.length;
            
            const centeredX = x.map(val => val - meanX);
            const centeredY = y.map(val => val - meanY);
            
            const covXX = centeredX.reduce((acc, val, i) => acc + val * centeredX[i], 0) / (x.length - 1);
            const covYY = centeredY.reduce((acc, val, i) => acc + val * centeredY[i], 0) / (y.length - 1);
            const covXY = centeredX.reduce((acc, val, i) => acc + val * centeredY[i], 0) / (x.length - 1);
            
            return [[covXX, covXY], [covXY, covYY]];
        }

        // Calculate correlation
        function calculateCorrelation(covMatrix) {
            return covMatrix[0][1] / Math.sqrt(covMatrix[0][0] * covMatrix[1][1]);
        }

        // Update visualization
        function updateVisualization() {
            const svg = document.getElementById('plot');
            const [x, y] = data;
            
            // Clear existing points
            const points = svg.querySelectorAll('circle');
            points.forEach(point => point.remove());
            
            // Rotate and plot points
            const scale = 80;
            const rotatedPoints = x.map((val, i) => rotatePoint(val, y[i], angle));
            
            rotatedPoints.forEach(([rx, ry]) => {
                const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                circle.setAttribute("cx", rx * scale);
                circle.setAttribute("cy", -ry * scale);
                circle.setAttribute("r", "3");
                circle.setAttribute("fill", "#18453B");
                circle.setAttribute("opacity", "0.5");
                svg.appendChild(circle);
            });
            
            // Update covariance matrix
            const rotatedX = rotatedPoints.map(p => p[0]);
            const rotatedY = rotatedPoints.map(p => p[1]);
            const covMatrix = calculateCovariance(rotatedX, rotatedY);
            
            const matrixElement = document.getElementById('covarianceMatrix');
            matrixElement.innerHTML = '';
            covMatrix.flat().forEach(value => {
                const cell = document.createElement('div');
                cell.className = 'matrix-cell';
                cell.textContent = value.toFixed(3);
                cell.style.backgroundColor = `rgba(24, 69, 59, ${Math.abs(value) * 0.5})`;
                cell.style.color = Math.abs(value) > 0.5 ? 'white' : 'black';
                matrixElement.appendChild(cell);
            });
            
            // Update correlation
            const correlation = calculateCorrelation(covMatrix);
            document.getElementById('correlationValue').textContent = correlation.toFixed(3);
        }

        // Animation loop
        function animate() {
            if (isPlaying) {
                angle = (angle + 1) % 360;
                document.getElementById('rotationSlider').value = angle;
                document.getElementById('angleDisplay').textContent = `${angle}째`;
                updateVisualization();
                animationId = requestAnimationFrame(animate);
            }
        }

        // Event listeners
        document.getElementById('playPause').addEventListener('click', () => {
            isPlaying = !isPlaying;
            document.getElementById('playPause').textContent = isPlaying ? 'Pause' : 'Play';
            if (isPlaying) animate();
        });

        document.getElementById('reset').addEventListener('click', () => {
            angle = 0;
            document.getElementById('rotationSlider').value = 0;
            document.getElementById('angleDisplay').textContent = '0째';
            updateVisualization();
        });

        document.getElementById('generateNew').addEventListener('click', () => {
            data = generateData();
            updateVisualization();
        });

        document.getElementById('rotationSlider').addEventListener('input', (e) => {
            isPlaying = false;
            document.getElementById('playPause').textContent = 'Play';
            angle = parseInt(e.target.value);
            document.getElementById('angleDisplay').textContent = `${angle}째`;
            updateVisualization();
        });

        // Initial setup
        data = generateData();
        updateVisualization();
    </script>
</body>
</html>
